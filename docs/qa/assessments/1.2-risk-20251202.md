# Risk Profile: Story 1.2 - Task Search and Filter

**Date:** 2025-12-02  
**Reviewer:** Quinn (Test Architect)  
**Story:** 1.2 Task Search and Filter  
**Epic:** Foundation & Quick Wins

---

## Executive Summary

| Metric | Value |
|--------|-------|
| **Total Risks Identified** | 9 |
| **Critical Risks** | 0 |
| **High Risks** | 3 |
| **Medium Risks** | 4 |
| **Low Risks** | 2 |
| **Risk Score** | 54/100 |

This story has **high complexity** due to missing dependencies (`react-router-dom`, `fuse.js`) and incomplete data model (no `tags`, `priority`, `status` fields on tasks). Significant scaffolding work required before core functionality can be implemented.

---

## Risk Matrix

| Risk ID   | Description                                        | Probability | Impact     | Score | Priority |
|-----------|----------------------------------------------------|-------------|------------|-------|----------|
| TECH-001  | Missing `react-router-dom` dependency for URL sync | High (3)    | Medium (2) | 6     | High     |
| TECH-002  | Missing `fuse.js` for fuzzy search                 | High (3)    | Medium (2) | 6     | High     |
| DATA-001  | TaskType missing tags, priority, status fields     | High (3)    | Medium (2) | 6     | High     |
| TECH-003  | Keyboard shortcut conflicts with browser defaults  | Medium (2)  | Medium (2) | 4     | Medium   |
| PERF-001  | Real-time search performance with large task lists | Medium (2)  | Medium (2) | 4     | Medium   |
| UX-001    | Filter UI complexity overwhelming users            | Medium (2)  | Low (1)    | 2     | Low      |
| TECH-004  | URL parameter encoding for special characters      | Medium (2)  | Medium (2) | 4     | Medium   |
| OPS-001   | Filter state desync between URL and UI             | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-002  | Date range filter requires date comparison logic   | Low (1)     | Medium (2) | 2     | Low      |

---

## Critical & High Risks Requiring Attention

### TECH-001: Missing `react-router-dom` Dependency

**Score: 6 (High)**

**Probability:** High - Package is not in `package.json`. AC9 requires URL parameter synchronization.

**Impact:** Medium - Without this, URL persistence won't work. Feature would need alternative implementation.

**Affected Components:**
- New search/filter hook
- URL sync logic
- App routing structure

**Mitigation:**
| Strategy | Actions |
|----------|---------|
| **Preventive** | Install `react-router-dom` before implementation |
| **Alternative** | Use `window.history.pushState/replaceState` + `URLSearchParams` if avoiding router |

**Recommendation:** Install `react-router-dom` as it's a standard dependency and will be useful for future features.

---

### TECH-002: Missing `fuse.js` for Fuzzy Search

**Score: 6 (High)**

**Probability:** High - Package is not in `package.json`. AC3 requires fuzzy matching.

**Impact:** Medium - Without fuzzy search, typo tolerance won't work as expected.

**Affected Components:**
- Search logic
- `useTaskSearch` hook

**Mitigation:**
| Strategy | Actions |
|----------|---------|
| **Preventive** | Install `fuse.js` (~6KB gzipped) |
| **Alternative** | Implement simple substring/includes matching (worse UX) |

**Recommendation:** Install `fuse.js` - it's lightweight and purpose-built for this use case.

---

### DATA-001: TaskType Missing Required Fields

**Score: 6 (High)**

**Probability:** High - Current `TaskType` lacks `tags`, `priority`, `status` (archived) fields needed for ACs 2, 4, 5.

**Impact:** Medium - Cannot implement filtering without these fields. Requires data model changes.

**Current TaskType:**
```typescript
interface TaskType {
  id: string;
  title: string;
  description?: string;
  date: Date;
  timeBlock?: number;
  time?: string;
  project?: ProjectName;
  persistent?: boolean;
  completed?: boolean;
  scheduledTime?: string;
}
```

**Required additions:**
- `tags?: string[]` - for AC2 (search by tags)
- `priority?: 'high' | 'medium' | 'low'` - for AC5 (filter by priority)
- `status?: 'pending' | 'completed' | 'archived'` - for AC4 (filter by status)

**Mitigation:**
| Strategy | Actions |
|----------|---------|
| **Preventive** | Extend TaskType interface with new fields |
| **Preventive** | Update task creation/edit forms to capture new fields |
| **Corrective** | Default existing tasks: `status: completed ? 'completed' : 'pending'`, `priority: 'medium'` |

**Note:** `completed` field exists but `archived` does not. Need to decide: add `status` enum or keep `completed` boolean + add `archived` boolean?

---

## Medium Risk Details

### TECH-003: Keyboard Shortcut Conflicts

**Score: 4 (Medium)**

**Description:** AC10 requires Cmd/Ctrl + F to focus search. This conflicts with browser's native "Find in Page" functionality.

**Mitigation:**
- Use `event.preventDefault()` to override browser default
- Consider alternative shortcut (Cmd/Ctrl + K is common in apps)
- Make shortcut configurable or add visual hint

---

### PERF-001: Search Performance with Large Lists

**Score: 4 (Medium)**

**Description:** AC1 requires real-time filtering. With 100+ tasks and fuzzy search, performance could degrade.

**Mitigation:**
- AC11 already specifies debouncing (good)
- Use Fuse.js threshold configuration to limit results
- Consider virtualized list for very large datasets
- Memoize filtered results with `useMemo`

---

### TECH-004: URL Parameter Encoding

**Score: 4 (Medium)**

**Description:** Search queries with special characters (quotes, ampersands, etc.) must be properly encoded in URLs.

**Mitigation:**
- Use `encodeURIComponent`/`decodeURIComponent`
- Test with edge case queries: `"task & notes"`, `#hashtag`

---

### OPS-001: Filter State Synchronization

**Score: 4 (Medium)**

**Description:** Keeping URL params, Zustand state, and UI in sync can cause race conditions or infinite loops.

**Mitigation:**
- Single source of truth: URL params drive state
- Use `useEffect` to sync URL → state on mount/change
- Debounce state → URL updates
- Avoid circular dependencies

---

## Low Risk Details

### UX-001: Filter UI Complexity

**Score: 2 (Low)**

With 5 filter dimensions (search, status, priority, date range, project), UI could become cluttered.

**Mitigation:**
- Use collapsible filter panel or popover
- Show active filter count as badge
- Clear visual hierarchy

### DATA-002: Date Range Filtering

**Score: 2 (Low)**

Date range calculations (this week, this month, custom) require careful date math.

**Mitigation:**
- Use `date-fns` (already installed) for date calculations
- Define clear boundaries (start of day, end of day)

---

## Dependency Analysis

### New Dependencies Required

| Package | Version | Purpose | Size |
|---------|---------|---------|------|
| `react-router-dom` | ^6.x | URL routing and params | ~14KB gzipped |
| `fuse.js` | ^7.x | Fuzzy search | ~6KB gzipped |

### Existing Dependencies to Leverage

| Package | Purpose |
|---------|---------|
| `date-fns` | Date range calculations |
| `zustand` | Filter state management |
| `shadcn/ui Select` | Filter dropdowns |
| `lucide-react` | Icons for UI |

---

## Implementation Order Recommendation

1. **Phase 1: Data Model** (blocks everything)
   - Extend `TaskType` with new fields
   - Update backend to handle new fields
   - Update create/edit forms

2. **Phase 2: Dependencies**
   - Install `fuse.js`
   - Install `react-router-dom` (or decide on alternative)

3. **Phase 3: Core Logic**
   - Create `useTaskFilter` hook
   - Implement search with Fuse.js
   - Implement filter logic

4. **Phase 4: UI**
   - Create `SearchInput` component
   - Create `FilterDropdown` components
   - Add keyboard shortcut

5. **Phase 5: URL Sync**
   - Sync filter state to URL params
   - Handle URL → state on mount

---

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests

| Test Type | Focus Area |
|-----------|------------|
| Integration | URL params correctly populate filters on page load |
| Unit | Fuzzy search returns expected matches with typos |
| Unit | Filter combinations work correctly |

### Priority 2: Medium Risk Tests

| Test Type | Focus Area |
|-----------|------------|
| Unit | Debounce prevents excessive re-renders |
| Manual | Keyboard shortcut works across browsers |
| Unit | Date range calculations are correct |

### Priority 3: Standard Tests

| Test Type | Focus Area |
|-----------|------------|
| E2E | Full search → filter → share URL flow |
| Manual | UI is intuitive and not overwhelming |

---

## Gate YAML Block

```yaml
# risk_summary (paste into gate file):
risk_summary:
  totals:
    critical: 0
    high: 3
    medium: 4
    low: 2
  highest:
    id: DATA-001
    score: 6
    title: 'TaskType missing tags, priority, status fields'
  recommendations:
    must_fix:
      - 'Install fuse.js for fuzzy search'
      - 'Install react-router-dom or implement URL sync alternative'
      - 'Extend TaskType with tags, priority, status fields'
    monitor:
      - 'Search performance with large task lists'
      - 'URL/state synchronization bugs'
```

---

## PO Clarifications (Resolved 2025-12-02)

1. **Status field:** ✅ Use `status: 'pending' | 'completed' | 'archived'` enum. Migrate existing `completed` boolean.

2. **Priority default:** ✅ Default is `'medium'` for all new and existing tasks.

3. **Keyboard shortcut:** ✅ Use `Cmd/Ctrl + K` (industry standard, avoids browser conflict). AC10 updated.

4. **Archived tasks:** ✅ Hidden by default. Show via status filter "Archived" or "Show All".

---

**Risk profile:** `docs/qa/assessments/1.2-risk-20251202.md`

