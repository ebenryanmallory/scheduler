# Test Design: Story 1.2 - Task Search and Filter

**Date:** 2025-12-02  
**Designer:** Quinn (Test Architect)  
**Story:** 1.2 Task Search and Filter  
**Epic:** Foundation & Quick Wins

---

## Test Strategy Overview

| Metric | Count | Percentage |
|--------|-------|------------|
| **Total Test Scenarios** | 32 | 100% |
| **Unit Tests** | 16 | 50% |
| **Integration Tests** | 10 | 31% |
| **E2E Tests** | 6 | 19% |

### Priority Distribution

| Priority | Count | Description |
|----------|-------|-------------|
| **P0** | 4 | Critical - must pass |
| **P1** | 16 | High - core functionality |
| **P2** | 10 | Medium - secondary features |
| **P3** | 2 | Low - edge cases |

---

## Test Scenarios by Acceptance Criteria

### AC1: Search input filters tasks in real-time

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-001 | Unit | P0 | Filter function returns matching tasks for exact title match | Core search logic |
| 1.2-UNIT-002 | Unit | P1 | Filter function returns empty array when no matches | Edge case handling |
| 1.2-INT-001 | Integration | P1 | Typing in search input updates displayed tasks immediately | Component interaction |
| 1.2-E2E-001 | E2E | P1 | User types search query, sees filtered results | User journey |

---

### AC2: Search matches against titles, descriptions, and tags

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-003 | Unit | P1 | Search matches task by title | Search field priority |
| 1.2-UNIT-004 | Unit | P1 | Search matches task by description | Multi-field search |
| 1.2-UNIT-005 | Unit | P1 | Search matches task by tag | Tag search capability |
| 1.2-UNIT-006 | Unit | P2 | Search prioritizes title matches over description | Result ranking |

---

### AC3: Fuzzy matching for typo tolerance

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-007 | Unit | P0 | Fuzzy search finds "meeting" when user types "meetng" | Typo tolerance core |
| 1.2-UNIT-008 | Unit | P1 | Fuzzy search finds "documentation" with "docuemntation" | Common transposition |
| 1.2-UNIT-009 | Unit | P2 | Fuzzy threshold rejects completely wrong queries | False positive prevention |

**Risk Coverage:** Mitigates TECH-002 (fuse.js dependency)

---

### AC4: Filter by status (pending, completed, archived)

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-010 | Unit | P1 | Filter returns only pending tasks when status=pending | Filter logic |
| 1.2-UNIT-011 | Unit | P1 | Filter returns only completed tasks when status=completed | Filter logic |
| 1.2-UNIT-012 | Unit | P1 | Filter returns only archived tasks when status=archived | Filter logic |
| 1.2-INT-002 | Integration | P1 | Status dropdown updates task list | Component interaction |

**Risk Coverage:** Mitigates DATA-001 (status field required)

---

### AC5: Filter by priority (high, medium, low)

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-013 | Unit | P1 | Filter returns only high priority tasks | Filter logic |
| 1.2-UNIT-014 | Unit | P2 | Filter allows multiple priority selections | Multi-select |
| 1.2-INT-003 | Integration | P1 | Priority dropdown updates task list | Component interaction |

**Risk Coverage:** Mitigates DATA-001 (priority field required)

---

### AC6: Filter by date range (today, this week, this month, custom)

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-015 | Unit | P1 | "Today" filter returns only today's tasks | Date calculation |
| 1.2-UNIT-016 | Unit | P1 | "This week" filter returns tasks within current week | Date range logic |
| 1.2-UNIT-017 | Unit | P2 | "This month" filter returns tasks within current month | Date range logic |
| 1.2-INT-004 | Integration | P2 | Custom date range picker works correctly | UI interaction |

---

### AC7: Combine multiple filters simultaneously

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-018 | Unit | P0 | Search + status filter returns intersection | Combined logic |
| 1.2-UNIT-019 | Unit | P1 | Search + priority + date filters all apply | Triple combination |
| 1.2-INT-005 | Integration | P1 | Multiple filter selections update results correctly | Full filter flow |
| 1.2-E2E-002 | E2E | P1 | User applies search + filters, sees correct results | User journey |

---

### AC8: "Clear all filters" button

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-020 | Unit | P1 | Clear function resets all filter state to defaults | Reset logic |
| 1.2-INT-006 | Integration | P1 | Clear button resets UI and shows all tasks | Component reset |
| 1.2-E2E-003 | E2E | P2 | User clicks clear, all filters reset, URL cleared | Full reset flow |

---

### AC9: Persist search/filter state in URL parameters

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-INT-007 | Integration | P0 | Filter changes update URL params | URL sync |
| 1.2-INT-008 | Integration | P1 | Page load with URL params applies filters | URL → state |
| 1.2-INT-009 | Integration | P2 | Special characters in search are URL-encoded | Encoding safety |
| 1.2-E2E-004 | E2E | P1 | Share filtered URL, recipient sees same results | Shareability |

**Risk Coverage:** Mitigates TECH-001 (react-router dependency), OPS-001 (state sync)

---

### AC10: Keyboard shortcut (Cmd/Ctrl + K) to focus search

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-INT-010 | Integration | P1 | Cmd/Ctrl+K focuses search input | Keyboard access |
| 1.2-E2E-005 | E2E | P2 | Keyboard shortcut works across browsers | Cross-browser |

**Risk Coverage:** Mitigates TECH-003 (no longer conflicts with browser - PO clarified Cmd+K)

---

### AC11: Debounce search input to prevent excessive re-renders

| ID | Level | Priority | Test Description | Justification |
|----|-------|----------|------------------|---------------|
| 1.2-UNIT-021 | Unit | P1 | Debounce delays filter execution by configured ms | Debounce logic |
| 1.2-UNIT-022 | Unit | P2 | Rapid typing only triggers one filter call | Performance |
| 1.2-E2E-006 | E2E | P2 | Search feels responsive without lag | UX validation |

**Risk Coverage:** Mitigates PERF-001 (search performance)

---

## Risk Coverage Matrix

| Risk ID | Risk Title | Test Coverage |
|---------|------------|---------------|
| TECH-001 | Missing react-router-dom | 1.2-INT-007/008/009, 1.2-E2E-004 |
| TECH-002 | Missing fuse.js | 1.2-UNIT-007/008/009 |
| DATA-001 | TaskType missing fields | 1.2-UNIT-010/011/012/013/014 |
| TECH-003 | Keyboard shortcut conflicts | 1.2-INT-010, 1.2-E2E-005 |
| PERF-001 | Search performance | 1.2-UNIT-021/022, 1.2-E2E-006 |
| OPS-001 | URL/state sync | 1.2-INT-007/008, 1.2-E2E-004 |

---

## Test Data Requirements

### Fixtures Needed

```typescript
// test/fixtures/tasks.ts

export const mockTasksForSearch = [
  {
    id: 'task-1',
    title: 'Morning standup meeting',
    description: 'Daily sync with team',
    tags: ['work', 'daily'],
    priority: 'high',
    status: 'pending',
    date: new Date(),
    scheduledTime: '09:00'
  },
  {
    id: 'task-2',
    title: 'Write documentation',
    description: 'Update API docs',
    tags: ['docs', 'work'],
    priority: 'medium',
    status: 'completed',
    date: new Date(),
    scheduledTime: '14:00'
  },
  {
    id: 'task-3',
    title: 'Review pull request',
    description: 'Code review for feature branch',
    tags: ['code', 'review'],
    priority: 'high',
    status: 'pending',
    date: new Date(Date.now() - 86400000), // yesterday
    scheduledTime: '11:00'
  },
  {
    id: 'task-4',
    title: 'Old archived task',
    description: 'No longer relevant',
    tags: ['archive'],
    priority: 'low',
    status: 'archived',
    date: new Date(Date.now() - 604800000), // week ago
    scheduledTime: '10:00'
  }
];

export const searchTestCases = [
  { query: 'meeting', expectedIds: ['task-1'] },
  { query: 'meetng', expectedIds: ['task-1'] }, // typo
  { query: 'work', expectedIds: ['task-1', 'task-2'] }, // tag match
  { query: 'API', expectedIds: ['task-2'] }, // description match
  { query: 'xyz123', expectedIds: [] }, // no match
];
```

---

## Recommended File Structure

```
src/
├── hooks/
│   └── useTaskFilter.ts          # Filter logic and state
│   └── useTaskFilter.test.ts     # Unit tests
├── components/
│   └── SearchInput.tsx           # Search input with debounce
│   └── FilterDropdown.tsx        # Reusable filter dropdown
│   └── TaskFilters.tsx           # Combined filter UI
│   └── ActiveFilters.tsx         # Show active filters with clear
tests/
├── integration/
│   └── taskFilters.test.ts       # Integration tests
├── e2e/
│   └── search-filter.spec.ts     # Playwright E2E tests
├── fixtures/
│   └── tasks.ts                  # Test data
```

---

## Recommended Execution Order

### CI Pipeline Order

```
1. P0 Unit Tests (fail fast)
   └── 1.2-UNIT-001, 007, 018 (core search logic)

2. P1 Unit Tests
   └── All remaining filter logic tests

3. P0 Integration Tests
   └── 1.2-INT-007 (URL sync)

4. P1 Integration Tests
   └── Component interaction tests

5. P1 E2E Tests
   └── 1.2-E2E-001, 002, 004 (user journeys)

6. P2+ Tests (if time permits)
   └── Edge cases and polish
```

### Manual Testing Required

| Browser | Tests | Notes |
|---------|-------|-------|
| All | Keyboard shortcut Cmd/Ctrl+F | Verify browser override works |
| Safari | URL persistence | Safari has quirks with pushState |
| Mobile | Filter UI usability | Dropdowns should be touch-friendly |

---

## Test Implementation Notes

### Unit Test Approach

```typescript
// Example: 1.2-UNIT-007 (fuzzy search)
describe('fuzzySearch', () => {
  it('finds "meeting" when user types "meetng"', () => {
    const tasks = mockTasksForSearch;
    const result = fuzzySearch(tasks, 'meetng');
    
    expect(result).toHaveLength(1);
    expect(result[0].id).toBe('task-1');
  });
});
```

### Integration Test Approach

```typescript
// Example: 1.2-INT-007 (URL sync)
describe('URL synchronization', () => {
  it('updates URL params when filter changes', async () => {
    render(<TaskFilters />, { wrapper: RouterWrapper });
    
    await userEvent.type(screen.getByRole('searchbox'), 'meeting');
    
    await waitFor(() => {
      expect(window.location.search).toContain('q=meeting');
    });
  });
});
```

### E2E Test Approach

```typescript
// Example: 1.2-E2E-004 (share URL)
test('shared filtered URL shows same results', async ({ page, context }) => {
  // User A applies filters
  await page.goto('/');
  await page.fill('[data-testid="search-input"]', 'meeting');
  await page.selectOption('[data-testid="status-filter"]', 'pending');
  
  const url = page.url();
  
  // User B opens shared URL
  const page2 = await context.newPage();
  await page2.goto(url);
  
  // Verify same filters applied
  await expect(page2.locator('[data-testid="search-input"]')).toHaveValue('meeting');
  await expect(page2.locator('[data-testid="status-filter"]')).toHaveValue('pending');
});
```

---

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
- [x] Risk mitigations are addressed

---

## Gate YAML Block

```yaml
# test_design (paste into gate file):
test_design:
  scenarios_total: 32
  by_level:
    unit: 16
    integration: 10
    e2e: 6
  by_priority:
    p0: 4
    p1: 16
    p2: 10
    p3: 2
  coverage_gaps: []
  risk_coverage:
    - TECH-001: 4 tests
    - TECH-002: 3 tests
    - DATA-001: 5 tests
    - TECH-003: 2 tests
    - PERF-001: 3 tests
    - OPS-001: 3 tests
```

---

## Prerequisites Before Implementation

1. **Install dependencies:**
   ```bash
   npm install fuse.js react-router-dom
   ```

2. **Extend TaskType:**
   ```typescript
   interface TaskType {
     // ... existing fields
     tags?: string[];
     priority?: 'high' | 'medium' | 'low';
     status?: 'pending' | 'completed' | 'archived';
   }
   ```

3. **Wrap App in Router:**
   ```tsx
   // main.tsx
   import { BrowserRouter } from 'react-router-dom';
   
   <BrowserRouter>
     <App />
   </BrowserRouter>
   ```

---

**Test design matrix:** `docs/qa/assessments/1.2-test-design-20251202.md`  
**P0 tests identified:** 4

