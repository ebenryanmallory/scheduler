# Risk Profile: Story 2.1 - Time Tracking Foundation

**Date:** 2025-12-02  
**Reviewer:** Quinn (Test Architect)  
**Story:** 2.1 - Time Tracking Foundation

## Executive Summary

- **Total Risks Identified:** 9
- **Critical Risks:** 0
- **High Risks:** 3
- **Risk Score:** 67/100 (moderate risk)

## Risk Matrix

| Risk ID | Description | Probability | Impact | Score | Priority |
|---------|-------------|-------------|--------|-------|----------|
| TECH-001 | Web Worker compatibility issues across browsers | Medium (2) | High (3) | 6 | High |
| TECH-002 | Timer drift in background tabs due to browser throttling | High (3) | Medium (2) | 6 | High |
| DATA-001 | Timer state loss on crash/unexpected close | Medium (2) | High (3) | 6 | High |
| PERF-001 | 30-second server sync causing UI jank | Medium (2) | Medium (2) | 4 | Medium |
| TECH-003 | Race condition with multiple tabs running timers | Medium (2) | Medium (2) | 4 | Medium |
| DATA-002 | LocalStorage quota exceeded with large history | Low (1) | Medium (2) | 2 | Low |
| OPS-001 | Vite Web Worker build configuration issues | Medium (2) | Low (1) | 2 | Low |
| BUS-001 | User confusion about timer persistence behavior | Low (1) | Medium (2) | 2 | Low |
| SEC-001 | Timer manipulation via localStorage tampering | Low (1) | Low (1) | 1 | Minimal |

## Critical Risks Requiring Immediate Attention

*No critical (score 9) risks identified.*

## High Risks (Score 6)

### 1. TECH-001: Web Worker Compatibility

**Score: 6 (High)**  
**Probability:** Medium - Most modern browsers support Web Workers, but Safari has quirks  
**Impact:** High - Timer would be non-functional without fallback

**Mitigation:**
- Implement feature detection for Web Worker support
- Create fallback to `setInterval` for unsupported browsers
- Use `performance.now()` for accurate elapsed time calculation regardless of method

**Testing Focus:**
- Test in Safari, Firefox, Chrome
- Test with Web Workers disabled
- Verify fallback behavior

### 2. TECH-002: Timer Drift in Background Tabs

**Score: 6 (High)**  
**Probability:** High - Browser throttling of background tabs is standard behavior  
**Impact:** Medium - Timer display may show wrong time until tab is focused

**Mitigation:**
- Store `startedAt` timestamp and calculate elapsed from current time
- Use Web Worker which runs independently of tab throttling
- On visibility change, recalculate elapsed time from stored timestamp
- Don't rely solely on tick accumulation

**Testing Focus:**
- Test timer accuracy after tab is backgrounded for 5+ minutes
- Verify recalculation on tab focus
- Test across browsers with different throttling behaviors

### 3. DATA-001: Timer State Loss

**Score: 6 (High)**  
**Probability:** Medium - Crashes are rare but do happen  
**Impact:** High - User loses tracked time, frustrating experience

**Mitigation:**
- Persist timer state to localStorage on every state change
- Persist to server every 30 seconds (already in AC4)
- On app load, restore timer state from localStorage first, then reconcile with server
- Store `startedAt` timestamp to calculate accurate elapsed time on restore

**Testing Focus:**
- Test page refresh while timer running
- Test browser crash simulation (force close)
- Verify state restoration accuracy

## Medium Risks (Score 4)

### 4. PERF-001: Server Sync Causing UI Jank

**Score: 4 (Medium)**

**Mitigation:**
- Use async/await with non-blocking fetch
- Don't block timer tick on server response
- Use optimistic UI updates
- Debounce/batch rapid changes

### 5. TECH-003: Multiple Tab Race Condition

**Score: 4 (Medium)**

**Mitigation:**
- Use BroadcastChannel API to coordinate across tabs
- Alternatively, use localStorage events for cross-tab communication
- Show warning in other tabs when timer is running
- AC9 already requires preventing multiple timers

## Low/Minimal Risks (Score 1-3)

### 6-9. Lower Priority Risks

| Risk ID | Mitigation |
|---------|------------|
| DATA-002 | Limit history array size, prune old entries |
| OPS-001 | Verify Vite config early, test build process |
| BUS-001 | Clear UI indicators for timer state |
| SEC-001 | Not a concern for local-first app, no sensitive data |

## Risk Distribution

### By Category
- Technical: 4 risks (3 high)
- Data: 2 risks (1 high)
- Performance: 1 risk (0 high)
- Business: 1 risk (0 high)
- Operational: 1 risk (0 high)
- Security: 0 significant risks

### By Component
- Frontend (Timer/Worker): 5 risks
- Storage (localStorage): 2 risks
- Server Integration: 2 risks

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests
1. **Web Worker fallback test** - Disable workers, verify timer still works
2. **Background tab accuracy test** - 5-minute background, verify time
3. **Page refresh persistence test** - Refresh mid-timer, verify continuity
4. **Multiple timer prevention test** - Attempt to start second timer

### Priority 2: Medium Risk Tests
1. **Server sync test** - Verify 30s persistence works
2. **Multi-tab coordination test** - Open multiple tabs, verify warning

### Priority 3: Low Risk Tests
1. **localStorage limit test** - Large history, verify graceful handling
2. **Build verification** - Confirm worker bundles correctly

## Risk Acceptance Criteria

### Must Fix Before Production
- TECH-001: Web Worker fallback (or document unsupported browsers)
- DATA-001: State persistence on refresh

### Can Deploy with Monitoring
- TECH-002: Background tab drift (with timestamp-based calculation)
- TECH-003: Multi-tab (with warning system)

### Accepted Risks
- SEC-001: localStorage tampering (local-first app, user's own data)
- DATA-002: History size (can add pruning later if needed)

## Monitoring Requirements

Post-deployment monitoring for:
- Timer accuracy complaints (feedback mechanism)
- Error logs from Web Worker initialization
- Server sync failure rates

---

## Gate YAML Block

```yaml
# risk_summary (paste into gate file):
risk_summary:
  totals:
    critical: 0
    high: 3
    medium: 2
    low: 4
  highest:
    id: TECH-001
    score: 6
    title: "Web Worker compatibility issues across browsers"
  recommendations:
    must_fix:
      - "Implement Web Worker feature detection with setInterval fallback"
      - "Use timestamp-based elapsed calculation, not tick accumulation"
      - "Persist timer state to localStorage on every state change"
    monitor:
      - "Timer accuracy after background tab restore"
      - "Cross-browser Web Worker initialization errors"
      - "Server sync failure rates"
```

---

**Risk profile:** docs/qa/assessments/2.1-risk-20251202.md









