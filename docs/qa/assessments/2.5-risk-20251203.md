# Risk Profile: Story 2.5 - Quick Stats Widget

**Date:** 2025-12-03  
**Reviewer:** Quinn (Test Architect)  
**Story:** 2.5 - Quick Stats Widget

## Executive Summary

- **Total Risks Identified:** 10
- **Critical Risks:** 0
- **High Risks:** 1
- **Medium Risks:** 4
- **Low Risks:** 5
- **Risk Score:** 78/100 (low-moderate risk)

This is a **low-to-moderate risk story** primarily involving frontend calculations and motivational UI features. The highest risk is streak calculation accuracy across date/timezone boundaries. Most risks are well-mitigated by following established patterns from Story 2.2 (TimeAnalyticsWidget).

## Risk Matrix

| Risk ID | Description | Probability | Impact | Score | Priority |
|---------|-------------|-------------|--------|-------|----------|
| DATA-001 | Streak calculation breaks at date/timezone boundaries | Medium (2) | High (3) | 6 | High |
| DATA-002 | Focus vs break time categorization unclear/inaccurate | Medium (2) | Medium (2) | 4 | Medium |
| PERF-001 | Two analytics widgets causing excessive re-renders | Medium (2) | Medium (2) | 4 | Medium |
| UX-001 | Milestone notifications become spammy/annoying | Medium (2) | Medium (2) | 4 | Medium |
| TECH-001 | Streak data lost or corrupted in localStorage | Low (1) | High (3) | 3 | Medium |
| UX-002 | Two widgets compete visually, cluttered dashboard | Low (1) | Medium (2) | 2 | Low |
| DATA-003 | Productivity score feels arbitrary or demotivating | Low (1) | Medium (2) | 2 | Low |
| TECH-002 | Animation performance issues on low-end devices | Low (1) | Low (1) | 1 | Low |
| BUS-001 | Gamification creates unhealthy pressure | Low (1) | Low (1) | 1 | Minimal |
| TECH-003 | SVG progress ring rendering inconsistencies | Low (1) | Low (1) | 1 | Minimal |

## Critical Risks Requiring Immediate Attention

**None identified.** This story has no critical (score 9) risks.

## High Risk Analysis

### DATA-001: Streak Calculation Date Boundary Issues

**Score: 6 (High)**

**Probability:** Medium - Date math is notoriously tricky, especially around midnight and timezone changes

**Impact:** High - Incorrect streaks undermine core motivational feature, user frustration

**Root Causes:**
- User's local timezone vs stored UTC dates
- DST transitions causing day length changes
- Midnight edge case (task completed at 11:59 PM vs 12:01 AM)
- Server-client time sync issues

**Affected Components:**
- `useQuickStats.ts` - `calculateStreak()` function
- localStorage streak persistence

**Mitigation Strategy:** Preventive
1. Use consistent date normalization (start of day in local timezone)
2. Store streak data with explicit timezone offset
3. Compare dates using `YYYY-MM-DD` strings, not Date objects
4. Add "grace period" - consider consecutive if ≤26 hours apart
5. Reuse `isSameDay()` helper from `useTimeAnalytics.ts`

**Testing Requirements:**
- Unit test streak across midnight boundary
- Unit test DST transition (spring forward, fall back)
- Manual test: change system timezone and verify streak
- Test "empty day" detection when user has no tasks

**Residual Risk:** Low - Well-established date handling patterns exist

---

## Medium Risk Analysis

### DATA-002: Focus vs Break Time Categorization

**Score: 4 (Medium)**

**Probability:** Medium - Story doesn't define how to distinguish focus vs break

**Impact:** Medium - Misleading focus/break ratio diminishes feature value

**Current Ambiguity:**
- AC4 says "focus time vs. break time" but no definition provided
- Tasks don't have a "type" field for focus/break
- Should all tracked time be "focus"? What's "break"?

**Mitigation Options:**
1. **Option A:** All tracked time = focus, break = untracked gaps (simple but crude)
2. **Option B:** Use task tags (requires user to tag tasks)
3. **Option C:** Infer from project (e.g., "Break" project)
4. **Option D:** Default work day (8h) minus tracked = break

**Recommendation:** 
- Implement Option A for MVP (tracked = focus)
- Show "Tracked Time" instead of "Focus Time" to set expectations
- Add note in UI: "Based on time-tracked tasks"

**Testing Requirements:**
- Verify calculation with various task configurations
- Document assumption in code comments

### PERF-001: Dual Widget Re-render Performance

**Score: 4 (Medium)**

**Probability:** Medium - Both widgets subscribe to taskStore, timer updates

**Impact:** Medium - UI lag, battery drain, poor UX

**Scenario:**
- TimeAnalyticsWidget already updates every 30s during active timer
- QuickStatsWidget will also need real-time updates
- Task completion triggers both widgets to recalculate

**Mitigation:**
- Share calculation logic between hooks where possible
- Use selective Zustand subscriptions (subscribe to specific slices)
- Debounce updates to 1-second minimum
- Memoize heavily with `useMemo`
- Consider combining into single "Analytics" section

**Testing Requirements:**
- Profile re-renders with React DevTools
- Measure frame rate during task completion
- Test with 100+ tasks to stress calculations

### UX-001: Milestone Notification Spam

**Score: 4 (Medium)**

**Probability:** Medium - Multiple milestones can trigger in quick succession

**Impact:** Medium - Annoying notifications reduce user satisfaction

**Spam Scenarios:**
- User completes 5 tasks rapidly → 5 "task completed" toasts + milestone toasts
- User returns after week → multiple catch-up milestones
- Page refresh → milestones re-trigger

**Mitigation:**
- Store seen milestones in localStorage with expiry
- Batch milestone notifications (show max 1 per minute)
- Dedupe: don't show "7-day streak" again within same streak
- Queue milestones and show most significant only
- Add user setting to disable celebrations

**Testing Requirements:**
- Test rapid task completion
- Test page refresh doesn't re-trigger
- Test milestone deduplication

### TECH-001: Streak Data Persistence

**Score: 3 (Medium)**

**Probability:** Low - localStorage is reliable

**Impact:** High - Losing a long streak is very frustrating

**Scenarios:**
- User clears browser data
- localStorage quota exceeded
- Corrupted JSON parse

**Mitigation:**
- Graceful fallback: recalculate streak from tasks if localStorage missing
- Validate localStorage data on read (schema check)
- Tasks are source of truth; localStorage is cache only
- Log warning if localStorage unavailable

**Testing Requirements:**
- Test with localStorage cleared
- Test with corrupted localStorage data
- Verify streak can be reconstructed from task history

---

## Low Risk Analysis

### UX-002: Visual Widget Competition

**Score: 2 (Low)**

**Description:** TimeAnalyticsWidget + QuickStatsWidget may clutter dashboard

**Mitigation:**
- Consistent visual styling (follow TimeAnalyticsWidget patterns)
- Both collapsible to minimize footprint
- Consider responsive stacking (mobile: stacked, desktop: side-by-side)
- Keep QuickStatsWidget more compact than TimeAnalyticsWidget

### DATA-003: Productivity Score Subjectivity

**Score: 2 (Low)**

**Description:** Formula-based score may not match user's perception

**Mitigation:**
- Make formula transparent (show breakdown on hover)
- Use encouraging messages at all score levels
- Never show "0%" or negative framing
- Consider making weights configurable (future)

### TECH-002: Animation Performance

**Score: 1 (Low)**

**Description:** Progress ring animations may lag on older devices

**Mitigation:**
- Use CSS transitions, not JS animations
- Reduce motion for `prefers-reduced-motion` users
- Keep animations subtle (0.3s, ease-out)

### BUS-001: Gamification Pressure

**Score: 1 (Minimal)**

**Description:** Streaks/scores could create unhealthy productivity pressure

**Mitigation:**
- Encouraging, not punishing messages
- No penalty for breaking streaks (just shows current)
- Collapsible/hideable widgets

### TECH-003: SVG Progress Ring Browser Issues

**Score: 1 (Minimal)**

**Description:** SVG strokeDasharray/strokeDashoffset rendering quirks

**Mitigation:**
- TimeAnalyticsWidget already uses SVG rings successfully
- Test in Chrome, Firefox, Safari
- Use CSS fallback colors

---

## Risk Distribution

### By Category
- Data/Calculation: 3 risks (1 high)
- Performance: 1 risk (0 high)
- UX/Design: 2 risks (0 high)
- Technical: 3 risks (0 high)
- Business: 1 risk (0 high)

### By Component
- useQuickStats hook: 4 risks
- QuickStatsWidget component: 3 risks
- Milestone system: 2 risks
- Integration: 1 risk

---

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests (DATA-001)
1. **Streak midnight boundary test** - Complete task at 11:59 PM, verify next day
2. **Streak gap detection test** - Skip a day, verify streak resets
3. **Streak reconstruction test** - Clear localStorage, verify streak recalculates
4. **Timezone change test** - Change TZ, verify streak consistency

### Priority 2: Medium Risk Tests
1. **Performance profiling** - Measure re-renders with both widgets active
2. **Milestone dedup test** - Trigger same milestone twice, verify single notification
3. **Focus time calculation test** - Verify tracked time sums correctly

### Priority 3: Low Risk Tests
1. **Progress ring animation** - Visual check across browsers
2. **Score formula verification** - Unit test calculation matches spec
3. **Responsive layout** - Check mobile vs desktop positioning

---

## Integration Considerations

### Reuse from Story 2.2
- `formatDuration()` utility
- `isSameDay()` helper
- `startOfDay()` helper
- Collapsible widget pattern
- localStorage persistence pattern

### Shared State Concerns
- Both widgets read from `taskStore`
- Consider extracting shared calculations to `src/lib/analytics.ts`
- Avoid duplicate date filtering logic

---

## Risk Acceptance Criteria

### Must Fix Before Production
- DATA-001: Streak date handling must use consistent timezone logic

### Can Deploy with Mitigation
- PERF-001: Deploy with memoization, monitor performance
- UX-001: Deploy with milestone deduplication
- DATA-002: Deploy with "Tracked Time" labeling (defer focus/break distinction)

### Accepted Risks
- TECH-002: Animation performance (use CSS, accept minor lag on old devices)
- BUS-001: Gamification concerns (positive framing mitigates)
- DATA-003: Score subjectivity (transparent formula, encouraging messages)

---

## Monitoring Requirements

Post-deployment monitoring for:
- User feedback on streak accuracy
- Performance metrics (render time with both widgets)
- Milestone notification frequency

---

## Gate YAML Block

```yaml
# risk_summary (paste into gate file):
risk_summary:
  totals:
    critical: 0
    high: 1
    medium: 4
    low: 5
  highest:
    id: DATA-001
    score: 6
    title: "Streak calculation breaks at date/timezone boundaries"
  recommendations:
    must_fix:
      - "Use consistent date normalization with local timezone"
      - "Store streak calculation based on YYYY-MM-DD strings"
      - "Recalculate streak from tasks if localStorage missing"
    monitor:
      - "Streak accuracy across timezone changes"
      - "Re-render performance with dual widgets"
      - "Milestone notification frequency"
```

---

**Risk profile:** `docs/qa/assessments/2.5-risk-20251203.md`

