# Risk Profile: Story 1.4 - Enhanced Error Handling

**Date:** 2025-12-02  
**Reviewer:** Quinn (Test Architect)  
**Story:** 1.4 Enhanced Error Handling  
**Epic:** Foundation & Quick Wins

---

## Executive Summary

| Metric | Value |
|--------|-------|
| **Total Risks Identified** | 7 |
| **Critical Risks** | 0 |
| **High Risks** | 1 |
| **Medium Risks** | 4 |
| **Low Risks** | 2 |
| **Risk Score** | 38/100 |

This story has **medium complexity**. Error boundaries and retry logic are well-established patterns. Main risk is ensuring comprehensive coverage across all API calls and components without missing edge cases.

---

## Risk Matrix

| Risk ID   | Description                                        | Probability | Impact     | Score | Priority |
|-----------|----------------------------------------------------|-------------|------------|-------|----------|
| TECH-001  | Incomplete error boundary coverage                 | High (3)    | Medium (2) | 6     | High     |
| TECH-002  | Retry logic causing duplicate operations           | Medium (2)  | Medium (2) | 4     | Medium   |
| UX-001    | Error messages not actionable for users            | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-003  | Exponential backoff causing long waits             | Medium (2)  | Low (1)    | 2     | Low      |
| OPS-001   | Production error logging not configured            | Medium (2)  | Medium (2) | 4     | Medium   |
| PERF-001  | Too many retries degrading user experience         | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-001  | Errors not properly categorized                    | Low (1)     | Low (1)    | 1     | Low      |

---

## High Risk Details

### TECH-001: Incomplete Error Boundary Coverage

**Score: 6 (High)**

**Probability:** High - Easy to miss wrapping components, especially lazy-loaded or deeply nested ones.

**Impact:** Medium - Uncaught errors will crash the entire app instead of graceful fallback.

**Affected Components:**
- Main App wrapper
- Lazy-loaded components (if any)
- Widget components (Calendar, Ideas, Projects, Tasks)
- Modal dialogs

**Mitigation:**
| Strategy | Actions |
|----------|---------|
| **Preventive** | Create top-level ErrorBoundary wrapping entire app |
| **Preventive** | Add granular ErrorBoundaries around critical widgets |
| **Corrective** | Add componentDidCatch logging for monitoring |

---

## Medium Risk Details

### TECH-002: Retry Logic Causing Duplicates

**Score: 4 (Medium)**

**Description:** Retrying POST/PUT/DELETE operations could create duplicate tasks, update wrong versions, or delete multiple times.

**Mitigation:**
- Only retry GET requests automatically
- For mutations, track operation status and prevent duplicate submissions
- Use idempotency keys for critical operations
- Show "Retrying..." state to prevent user from clicking again

### UX-001: Non-Actionable Error Messages

**Score: 4 (Medium)**

**Description:** Generic error messages like "Something went wrong" don't help users resolve issues.

**Mitigation:**
- Map specific error codes to actionable messages
- Network errors: "Check your internet connection"
- 401/403: "Please log in again"  
- 404: "This item may have been deleted"
- 500: "Server issue - please try again later"

### OPS-001: Production Error Logging

**Score: 4 (Medium)**

**Description:** AC7 requires production error tracking. Without it, issues in production go unnoticed.

**Mitigation:**
- Create ErrorService with environment-aware logging
- Console.log in development, external service in production
- Structure for future integration with Sentry/LogRocket/etc.
- Include context (user action, component, timestamp)

### PERF-001: Retry Degradation

**Score: 4 (Medium)**

**Description:** 3 retries with exponential backoff could take 7+ seconds, frustrating users.

**Mitigation:**
- Show retry progress indicator
- Allow user to cancel and manually retry
- Use reasonable backoff: 1s, 2s, 4s (total ~7s max)
- Immediate fail for non-recoverable errors (401, 403, 404)

---

## Low Risk Details

### TECH-003: Long Backoff Waits

**Score: 2 (Low)**

With exponential backoff, the 3rd retry at 4s can feel slow. Keep initial delays short.

### DATA-001: Error Categorization

**Score: 1 (Low)**

Different error types (network, auth, validation, server) need different handling.

---

## Existing Infrastructure

### Already in Place
- `react-hot-toast` already installed and configured in App.tsx
- Toast notifications used for task creation success/failure
- Basic error states in stores (useTaskStore.error, useIdeaStore.error)

### Needs Creation
- ErrorBoundary component
- ErrorService for logging abstraction
- Retry wrapper/utility for API calls
- Standardized error message mappings
- Fallback UI component

---

## Implementation Recommendations

### Phase 1: Error Boundary Infrastructure
1. Create ErrorBoundary component with fallback UI
2. Create ErrorService with environment-aware logging
3. Wrap App with top-level boundary

### Phase 2: API Retry Logic
1. Create retry utility with exponential backoff
2. Update taskService, ideaService, projectService
3. Add retry configuration (max attempts, delays)

### Phase 3: User-Facing Improvements
1. Create error message mappings
2. Add "Retry" buttons to error states
3. Update all toast notifications for consistency

---

## Gate YAML Block

```yaml
risk_summary:
  totals:
    critical: 0
    high: 1
    medium: 4
    low: 2
  highest:
    id: TECH-001
    score: 6
    title: 'Incomplete error boundary coverage'
  recommendations:
    must_fix:
      - 'Create ErrorBoundary wrapping entire app'
      - 'Implement retry logic for GET requests'
      - 'Create actionable error messages'
    monitor:
      - 'Ensure all widgets have error boundaries'
      - 'Verify retry logic doesn't cause duplicates'
```

---

**Risk profile:** `docs/qa/assessments/1.4-risk-20251202.md`

