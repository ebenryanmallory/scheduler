# Risk Profile: Story 1.3 - Dark Mode Implementation

**Date:** 2025-12-02  
**Reviewer:** Quinn (Test Architect)  
**Story:** 1.3 Dark Mode Implementation  
**Epic:** Foundation & Quick Wins

---

## Executive Summary

| Metric | Value |
|--------|-------|
| **Total Risks Identified** | 6 |
| **Critical Risks** | 0 |
| **High Risks** | 1 |
| **Medium Risks** | 3 |
| **Low Risks** | 2 |
| **Risk Score** | 32/100 |

This story has **low to medium complexity**. Tailwind CSS dark mode support is well-documented and straightforward. Main risk is ensuring all components (especially third-party shadcn/ui) properly support dark mode without manual overrides.

---

## Risk Matrix

| Risk ID   | Description                                        | Probability | Impact     | Score | Priority |
|-----------|----------------------------------------------------|-------------|------------|-------|----------|
| UI-001    | Inconsistent component styling in dark mode        | High (3)    | Medium (2) | 6     | High     |
| UI-002    | Poor contrast ratios failing WCAG AA              | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-001  | Theme flash on page load (FOUC)                   | Medium (2)  | Low (1)    | 2     | Low      |
| UX-001    | Transition jank during theme switch               | Low (1)     | Low (1)    | 1     | Low      |
| DATA-001  | localStorage unavailable in private browsing      | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-002  | Meta theme-color not updating on toggle           | Medium (2)  | Medium (2) | 4     | Medium   |

---

## High Risk Details

### UI-001: Inconsistent Component Styling

**Score: 6 (High)**

**Probability:** High - Some components may have hardcoded colors or not use CSS variables.

**Impact:** Medium - Visual inconsistencies damage perceived quality but don't break functionality.

**Affected Components:**
- Custom styled components (CalendarWidget, TimeBlocksPanel)
- shadcn/ui components
- Third-party components (toast, date-picker)

**Mitigation:**
| Strategy | Actions |
|----------|---------|
| **Preventive** | Audit all components for hardcoded colors |
| **Preventive** | Use Tailwind `dark:` prefix consistently |
| **Corrective** | Create component-specific dark mode overrides if needed |

---

## Medium Risk Details

### UI-002: WCAG AA Contrast Compliance

**Score: 4 (Medium)**

**Description:** Dark mode colors must meet WCAG AA minimum contrast ratio (4.5:1 for normal text, 3:1 for large text).

**Mitigation:**
- Use contrast checker tool during implementation
- Test with browser dev tools accessibility audit
- Prefer established dark mode palettes (e.g., shadcn/ui defaults)

### DATA-001: localStorage Unavailable

**Score: 4 (Medium)**

**Description:** Some browsers in private mode block localStorage.

**Mitigation:**
- Wrap localStorage access in try/catch
- Fall back to in-memory state if localStorage fails
- Always have system preference as fallback

### TECH-002: Meta Theme-Color Update

**Score: 4 (Medium)**

**Description:** AC9 requires updating `<meta name="theme-color">` for mobile browser chrome.

**Mitigation:**
- Update meta tag programmatically on theme change
- Include in ThemeProvider initialization

---

## Low Risk Details

### TECH-001: Flash of Unstyled Content (FOUC)

**Score: 2 (Low)**

**Description:** Brief flash of wrong theme on page load before JavaScript hydrates.

**Mitigation:**
- Add inline script in `<head>` to read localStorage and set `dark` class before render
- This prevents React hydration mismatch

### UX-001: Transition Jank

**Score: 1 (Low)**

**Description:** AC5 requires 0.2s transition. Complex components might animate poorly.

**Mitigation:**
- Apply `transition-colors` only, not `transition-all`
- Test on lower-end devices

---

## Implementation Recommendations

### Tailwind Configuration

```javascript
// tailwind.config.js
module.exports = {
  darkMode: 'class', // Use class-based dark mode
  theme: {
    extend: {
      colors: {
        // Use CSS variables for dynamic theming
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        // ... etc
      }
    }
  }
}
```

### Recommended Implementation Order

1. **Phase 1: Infrastructure**
   - Update tailwind.config.js for class-based dark mode
   - Define CSS variables in index.css for light/dark themes
   - Create ThemeProvider context

2. **Phase 2: Core Components**
   - Add theme toggle button to header
   - Implement localStorage persistence
   - Add system preference detection

3. **Phase 3: Component Audit**
   - Update all custom components with `dark:` variants
   - Verify shadcn/ui components work correctly
   - Test all screens

4. **Phase 4: Polish**
   - Add smooth transitions
   - Update meta theme-color
   - Test keyboard accessibility

---

## Existing Assets

### Already Using
- Tailwind CSS (dark mode ready)
- shadcn/ui (dark mode compatible)
- lucide-react (icons for toggle)
- CSS variables already in use (partial)

### Needs Creation
- ThemeProvider context
- Theme toggle component
- CSS variable definitions for dark palette

---

## Gate YAML Block

```yaml
risk_summary:
  totals:
    critical: 0
    high: 1
    medium: 3
    low: 2
  highest:
    id: UI-001
    score: 6
    title: 'Inconsistent component styling in dark mode'
  recommendations:
    must_fix:
      - 'Audit all components for hardcoded colors'
      - 'Define CSS variables for dark theme'
    monitor:
      - 'WCAG contrast ratios'
      - 'Third-party component dark mode support'
```

---

**Risk profile:** `docs/qa/assessments/1.3-risk-20251202.md`

