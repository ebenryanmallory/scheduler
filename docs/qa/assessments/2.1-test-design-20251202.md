# Test Design: Story 2.1 - Time Tracking Foundation

**Date:** 2025-12-02  
**Designer:** Quinn (Test Architect)  
**Story:** 2.1 - Time Tracking Foundation

## Test Strategy Overview

- **Total test scenarios:** 28
- **Unit tests:** 14 (50%)
- **Integration tests:** 10 (36%)
- **E2E tests:** 4 (14%)
- **Priority distribution:** P0: 8, P1: 12, P2: 8

## Test Scenarios by Acceptance Criteria

### AC1: Task Type Time Tracking Fields

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-001 | Unit | P1 | TaskType includes estimatedDuration field | Type validation |
| 2.1-UNIT-002 | Unit | P1 | TaskType includes actualDuration field | Type validation |
| 2.1-UNIT-003 | Unit | P1 | TaskType includes timeTracking state object | Type validation |
| 2.1-INT-001 | Integration | P1 | Server accepts and returns time tracking fields | API contract |

### AC2: Timer Component with Start/Pause/Stop

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-004 | Unit | P0 | Timer displays in HH:MM:SS format | Pure formatting logic |
| 2.1-UNIT-005 | Unit | P0 | Start button initiates timer counting | State transition |
| 2.1-UNIT-006 | Unit | P0 | Pause button pauses timer | State transition |
| 2.1-UNIT-007 | Unit | P0 | Stop button stops and saves timer | State transition |
| 2.1-INT-002 | Integration | P0 | TaskTimer component renders in Task card | Component integration |
| 2.1-E2E-001 | E2E | P0 | User can start, pause, resume, and stop timer | Critical user journey |

### AC3: Timer Persists Through Page Refresh

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-008 | Unit | P0 | Timer state saved to localStorage on change | Persistence logic |
| 2.1-UNIT-009 | Unit | P0 | Timer state restored from localStorage on mount | Restore logic |
| 2.1-INT-003 | Integration | P1 | Page refresh preserves running timer state | Multi-system integration |
| 2.1-E2E-002 | E2E | P0 | Timer continues counting after page refresh | Critical persistence |

### AC4: Server Persistence Every 30 Seconds

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-010 | Unit | P1 | Auto-save interval triggers at 30 seconds | Timer logic |
| 2.1-INT-004 | Integration | P1 | Timer state syncs to server at interval | API integration |
| 2.1-INT-005 | Integration | P2 | Offline queue handles sync failures gracefully | Error handling |

### AC5: Actual Duration Calculated on Stop

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-011 | Unit | P1 | Stop calculates actualDuration from accumulated time | Pure calculation |
| 2.1-UNIT-012 | Unit | P1 | Multiple pause/resume sessions accumulate correctly | Edge case logic |

### AC6: Manual Time Entry

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-INT-006 | Integration | P1 | Manual time entry input accepts minutes | Form integration |
| 2.1-INT-007 | Integration | P2 | Manual entry updates actualDuration on task | State update |
| 2.1-E2E-003 | E2E | P2 | User can log time manually without timer | User journey |

### AC7: Time Tracking Status Display

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-013 | Unit | P1 | Status badge shows "not started" for new task | Display logic |
| 2.1-INT-008 | Integration | P1 | Status badge updates in real-time with timer | UI state sync |

### AC8: Web Worker for Accurate Timing

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-014 | Unit | P1 | Web Worker sends tick messages every second | Worker behavior |
| 2.1-INT-009 | Integration | P2 | Fallback to setInterval when Worker unavailable | Graceful degradation |

### AC9: Prevent Multiple Simultaneous Timers

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-INT-010 | Integration | P0 | Starting new timer when one running shows conflict | Store state check |

### AC10: Warning for Concurrent Timer Attempt

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-E2E-004 | E2E | P1 | Warning toast shown when starting second timer | User feedback |

## Risk Coverage

| Risk ID | Test IDs | Coverage |
|---------|----------|----------|
| TECH-001 (Web Worker compat) | 2.1-INT-009 | ✅ Fallback test |
| TECH-002 (Background drift) | 2.1-UNIT-009, 2.1-INT-003 | ✅ Timestamp restore |
| DATA-001 (State loss) | 2.1-UNIT-008, 2.1-UNIT-009, 2.1-E2E-002 | ✅ Persistence tests |
| TECH-003 (Multi-tab) | 2.1-INT-010 | ✅ Prevention test |

## Test Implementation Guide

### Unit Test Files

**File:** `src/hooks/__tests__/useTimer.test.ts`

```typescript
describe('useTimer', () => {
  // 2.1-UNIT-004: Timer format
  it('formats elapsed time as HH:MM:SS')
  
  // 2.1-UNIT-005: Start
  it('starts timer and sets isRunning to true')
  
  // 2.1-UNIT-006: Pause
  it('pauses timer and preserves elapsed time')
  
  // 2.1-UNIT-007: Stop
  it('stops timer and calculates final duration')
  
  // 2.1-UNIT-008: Save state
  it('saves state to localStorage on state change')
  
  // 2.1-UNIT-009: Restore state
  it('restores state from localStorage on mount')
  
  // 2.1-UNIT-011, 2.1-UNIT-012: Calculations
  it('calculates duration from multiple sessions')
})
```

**File:** `src/store/__tests__/timerStore.test.ts`

```typescript
describe('timerStore', () => {
  // 2.1-INT-010: Conflict prevention
  it('prevents setting active timer when one exists')
  
  // 2.1-UNIT-010: Auto-save interval
  it('triggers auto-save after 30 seconds')
})
```

### Integration Test Files

**File:** `src/components/__tests__/TaskTimer.test.tsx`

```typescript
describe('TaskTimer', () => {
  // 2.1-INT-002: Component rendering
  it('renders timer controls in task card')
  
  // 2.1-INT-008: Status badge
  it('shows correct status badge for timer state')
  
  // 2.1-INT-006, 2.1-INT-007: Manual entry
  it('accepts manual time entry and updates task')
})
```

### E2E Test File

**File:** `e2e/time-tracking.spec.ts`

```typescript
describe('Time Tracking', () => {
  // 2.1-E2E-001: Full timer flow
  test('user can start, pause, resume, and stop timer')
  
  // 2.1-E2E-002: Persistence
  test('timer continues after page refresh')
  
  // 2.1-E2E-003: Manual entry
  test('user can log time manually')
  
  // 2.1-E2E-004: Warning
  test('shows warning when starting second timer')
})
```

## Recommended Execution Order

1. **P0 Unit tests** (2.1-UNIT-004 through 2.1-UNIT-009) - Fail fast on core logic
2. **P0 Integration tests** (2.1-INT-002, 2.1-INT-010) - Component wiring
3. **P0 E2E tests** (2.1-E2E-001, 2.1-E2E-002) - Critical paths
4. **P1 tests** - Secondary functionality
5. **P2 tests** - Edge cases and nice-to-haves

## Test Data Requirements

```typescript
const mockTask: TaskType = {
  id: 'test-task-1',
  title: 'Test Task',
  date: new Date(),
  estimatedDuration: 60,
  actualDuration: 0,
  timeTracking: {
    status: 'not_started',
    accumulatedMs: 0,
    history: []
  }
}

const mockRunningTimerState = {
  status: 'in_progress',
  startedAt: '2025-12-02T10:00:00Z',
  accumulatedMs: 0,
  history: []
}
```

## Quality Checklist

- [x] Every AC has test coverage (all 10 covered)
- [x] Test levels are appropriate (unit for logic, integration for wiring, E2E for journeys)
- [x] No duplicate coverage across levels
- [x] Priorities align with risk profile
- [x] Test IDs follow naming convention (2.1-{LEVEL}-{SEQ})
- [x] Scenarios are atomic and independent

---

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 28
  by_level:
    unit: 14
    integration: 10
    e2e: 4
  by_priority:
    p0: 8
    p1: 12
    p2: 8
  coverage_gaps: []  # All ACs have test coverage
```

---

**Test design matrix:** docs/qa/assessments/2.1-test-design-20251202.md  
**P0 tests identified:** 8






