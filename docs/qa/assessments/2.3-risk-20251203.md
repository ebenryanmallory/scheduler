# Risk Assessment: Story 2.3 - Drag and Drop Task Scheduling

**Story**: 2.3 - Drag and Drop Task Scheduling  
**Assessed by**: Quinn (Test Architect)  
**Date**: 2025-12-03  
**Status**: Assessment Complete

---

## Executive Summary

Story 2.3 introduces cross-container drag-and-drop functionality for scheduling tasks into time blocks. The implementation uses dnd-kit library with unified DndContext, custom collision detection, and comprehensive state management. **Overall Risk Level: MEDIUM** - Primary concerns around cross-browser compatibility and touch device behavior.

---

## Risk Register

### TECH-001: Cross-Browser dnd-kit Compatibility
| Attribute | Value |
|-----------|-------|
| **Category** | Technical |
| **Likelihood** | Medium (3) |
| **Impact** | Medium (3) |
| **Risk Score** | 9 |
| **Priority** | HIGH |

**Description**: dnd-kit relies on Pointer Events API which has varying support across browsers. Touch sensors may behave differently on iOS Safari vs Android Chrome.

**Mitigation Applied**:
- ✅ Configured both MouseSensor and TouchSensor with appropriate activation constraints
- ✅ 200ms touch delay to differentiate from scroll (AC8)
- ✅ Uses `restrictToWindowEdges` modifier to prevent drag outside viewport

**Residual Risk**: Safari touch handling may still have edge cases. Monitor user reports.

---

### TECH-002: Stale Closure in Drag Handlers
| Attribute | Value |
|-----------|-------|
| **Category** | Technical |
| **Likelihood** | Medium (3) |
| **Impact** | High (4) |
| **Risk Score** | 12 |
| **Priority** | HIGH |

**Description**: React's useCallback with drag handlers may capture stale task state, causing incorrect scheduling or data corruption.

**Mitigation Applied**:
- ✅ `recordOperationRef` pattern used to avoid stale closure for undo history
- ✅ Tasks are looked up fresh from props in handlers (`tasks.find(t => t.id === taskId)`)
- ✅ State reset happens before async operations in `handleDragEnd`

**Residual Risk**: Low - pattern correctly implemented.

---

### DATA-001: Optimistic Update Race Condition
| Attribute | Value |
|-----------|-------|
| **Category** | Data Integrity |
| **Likelihood** | Low (2) |
| **Impact** | High (4) |
| **Risk Score** | 8 |
| **Priority** | MEDIUM |

**Description**: If server update fails after optimistic UI update, user may see inconsistent state.

**Mitigation Applied**:
- ✅ Task store handles persistence through existing patterns (AC10)
- ✅ Toast error shown on failure
- ✅ Undo history allows manual recovery (AC9)

**Residual Risk**: No automatic rollback on server error - user must manually undo.

---

### UX-001: Accidental Drag Activation
| Attribute | Value |
|-----------|-------|
| **Category** | User Experience |
| **Likelihood** | Medium (3) |
| **Impact** | Low (2) |
| **Risk Score** | 6 |
| **Priority** | LOW |

**Description**: Users may accidentally trigger drag when trying to click checkboxes or buttons.

**Mitigation Applied**:
- ✅ MouseSensor has 8px distance activation constraint
- ✅ TouchSensor has 200ms delay + 8px tolerance
- ✅ DragCancel handler resets state cleanly

**Residual Risk**: Low - constraints are reasonable defaults.

---

### UX-002: Large Time Change Without Confirmation
| Attribute | Value |
|-----------|-------|
| **Category** | User Experience |
| **Likelihood** | Low (2) |
| **Impact** | Medium (3) |
| **Risk Score** | 6 |
| **Priority** | LOW |

**Description**: Users may accidentally reschedule tasks significantly (>1 hour).

**Mitigation Applied**:
- ✅ Confirmation dialog for changes ≥60 minutes (AC11)
- ✅ Dialog shows clear before/after times
- ✅ Cancel option available

**Residual Risk**: None - fully mitigated.

---

### PERF-001: Collision Detection Performance
| Attribute | Value |
|-----------|-------|
| **Category** | Performance |
| **Likelihood** | Low (2) |
| **Impact** | Medium (3) |
| **Risk Score** | 6 |
| **Priority** | LOW |

**Description**: Custom collision detection runs on every mouse move during drag. May impact performance with many drop zones.

**Mitigation Applied**:
- ✅ Collision detection uses efficient `pointerWithin` first, falls back to `rectIntersection`
- ✅ Early return when time-block collision found
- ✅ `useMemo` wraps collision detection factory

**Residual Risk**: Low - time blocks are finite (typically <30 per day).

---

### TECH-003: Undo Keyboard Shortcut Conflicts
| Attribute | Value |
|-----------|-------|
| **Category** | Technical |
| **Likelihood** | Medium (3) |
| **Impact** | Low (2) |
| **Risk Score** | 6 |
| **Priority** | LOW |

**Description**: Ctrl+Z/Cmd+Z keyboard shortcut may conflict with browser or text input undo.

**Mitigation Applied**:
- ✅ Shortcut disabled when focus is on INPUT or TEXTAREA elements
- ✅ Only triggers if undo history has items

**Residual Risk**: May conflict with browser's page undo in edge cases.

---

### TECH-004: Task List Drop Zone Nested Context
| Attribute | Value |
|-----------|-------|
| **Category** | Technical |
| **Likelihood** | Low (2) |
| **Impact** | Medium (3) |
| **Risk Score** | 6 |
| **Priority** | LOW |

**Description**: TaskListDropZone is a droppable within a SortableContext, which creates nested dnd-kit interactions.

**Mitigation Applied**:
- ✅ Unified DndContext at ScheduleView level
- ✅ SortableContext for reordering is child of main DndContext
- ✅ Drop zone ID (`task-list-drop-zone`) distinct from task IDs

**Residual Risk**: Low - dnd-kit handles nested contexts.

---

### ACCESS-001: Keyboard Drag Accessibility
| Attribute | Value |
|-----------|-------|
| **Category** | Accessibility |
| **Likelihood** | Medium (3) |
| **Impact** | Medium (3) |
| **Risk Score** | 9 |
| **Priority** | MEDIUM |

**Description**: Users relying on keyboard navigation need alternative way to schedule tasks.

**Mitigation Applied**:
- ✅ KeyboardSensor configured with sortableKeyboardCoordinates
- ✅ Existing edit dialog remains available for scheduling

**Residual Risk**: Keyboard drag to specific time block may be challenging. Screen reader announcements not verified.

---

### TECH-005: AC6 Task Resizing Deferred
| Attribute | Value |
|-----------|-------|
| **Category** | Scope |
| **Likelihood** | Certain (5) |
| **Impact** | Low (2) |
| **Risk Score** | 10 |
| **Priority** | LOW (Deferred) |

**Description**: AC6 (task resizing to adjust duration) not implemented in this iteration.

**Mitigation Applied**:
- ✅ Documented as deferred in story tasks
- ✅ Does not block core scheduling functionality

**Residual Risk**: Feature gap - users cannot visually resize tasks. Must use edit dialog.

---

## Risk Summary

| Severity | Count |
|----------|-------|
| Critical | 0 |
| High | 2 |
| Medium | 2 |
| Low | 6 |
| **Total** | **10** |

### Must Fix Before Release
- None - all high risks have adequate mitigations

### Monitor After Release
- Cross-browser touch behavior (TECH-001)
- Server sync failure rates and user recovery (DATA-001)
- Accessibility complaints (ACCESS-001)

---

## Recommendation

**PASS** - Proceed with quality gate review. All critical risks mitigated. Deferred AC6 (resizing) is documented and acceptable for MVP. Key areas to monitor:
1. iOS Safari touch drag behavior
2. Screen reader announcements during drag operations
3. User feedback on confirmation dialog threshold (60 minutes)
