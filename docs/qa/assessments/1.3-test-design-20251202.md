# Test Design: Story 1.3 - Dark Mode Implementation

**Date:** 2025-12-02  
**Reviewer:** Quinn (Test Architect)  
**Story:** 1.3 Dark Mode Implementation  
**Epic:** Foundation & Quick Wins

---

## Test Strategy Overview

| Test Level | Scope | Priority |
|------------|-------|----------|
| Unit Tests | ThemeProvider, localStorage helpers | Medium |
| Component Tests | ThemeToggle button behavior | High |
| Integration Tests | Theme persistence across navigation | High |
| Visual Regression | All screens in both themes | High |
| Accessibility | WCAG AA contrast, keyboard navigation | High |

---

## Acceptance Criteria Test Matrix

| AC# | Acceptance Criteria | Test Type | Test Cases |
|-----|---------------------|-----------|------------|
| 1 | Theme toggle button in header | Component | TC-001 |
| 2 | Dark palette with WCAG AA contrast | Visual/A11y | TC-002, TC-003 |
| 3 | Persist theme in localStorage | Unit | TC-004, TC-005 |
| 4 | Detect system theme on first load | Integration | TC-006, TC-007 |
| 5 | Smooth transitions (0.2s) | Visual | TC-008 |
| 6 | All components support both modes | Visual | TC-009 |
| 7 | shadcn/ui dark mode compatibility | Visual | TC-010 |
| 8 | Theme context accessible app-wide | Unit | TC-011 |
| 9 | Meta theme-color updates | Integration | TC-012 |
| 10 | Keyboard accessible toggle | A11y | TC-013 |

---

## Test Cases

### TC-001: Theme Toggle Button Visibility

**AC Reference:** AC1  
**Priority:** High  
**Type:** Component

**Preconditions:**
- App is loaded in default (light) theme

**Steps:**
1. Look for theme toggle button in header
2. Verify button is visible
3. Verify button has appropriate icon (Sun for light, Moon for dark)

**Expected Results:**
- Toggle button is visible in header
- Icon reflects current theme state

---

### TC-002: Dark Mode Color Contrast

**AC Reference:** AC2  
**Priority:** High  
**Type:** Accessibility

**Preconditions:**
- Dark mode is enabled

**Steps:**
1. Run automated contrast checker on all text elements
2. Verify body text meets 4.5:1 ratio
3. Verify large text (>18px) meets 3:1 ratio
4. Check interactive element boundaries

**Expected Results:**
- All text passes WCAG AA contrast requirements
- No text is illegible against background

---

### TC-003: Dark Mode Visual Audit

**AC Reference:** AC2, AC6  
**Priority:** High  
**Type:** Visual

**Preconditions:**
- Dark mode is enabled

**Steps:**
1. Navigate through all major screens:
   - Main schedule view
   - Calendar widget
   - Task list
   - Ideas widget
   - Projects widget
   - Modals (Create Task, Edit Task)
2. Check for:
   - Hardcoded white/black colors
   - Missing dark variants
   - Illegible text

**Expected Results:**
- All screens have consistent dark styling
- No white backgrounds bleeding through
- All text is readable

---

### TC-004: localStorage Persistence

**AC Reference:** AC3  
**Priority:** High  
**Type:** Unit

**Preconditions:**
- Fresh browser state (no existing preference)

**Steps:**
1. Toggle theme to dark mode
2. Check localStorage for theme key
3. Refresh page
4. Verify theme is still dark

**Expected Results:**
- `theme` key exists in localStorage with value `dark`
- Theme persists across page refreshes

---

### TC-005: localStorage Unavailable Fallback

**AC Reference:** AC3  
**Priority:** Medium  
**Type:** Unit

**Preconditions:**
- Simulate localStorage being unavailable (private browsing)

**Steps:**
1. Mock localStorage to throw on access
2. Toggle theme to dark mode
3. Verify app doesn't crash
4. Verify theme still works in-memory

**Expected Results:**
- App gracefully handles localStorage failure
- Theme toggle still works within session

---

### TC-006: System Theme Detection - Dark

**AC Reference:** AC4  
**Priority:** High  
**Type:** Integration

**Preconditions:**
- No existing theme preference in localStorage
- System preference is dark mode

**Steps:**
1. Clear localStorage
2. Set system to dark mode
3. Load app fresh

**Expected Results:**
- App automatically uses dark theme
- Toggle shows moon icon

---

### TC-007: System Theme Detection - Light

**AC Reference:** AC4  
**Priority:** High  
**Type:** Integration

**Preconditions:**
- No existing theme preference in localStorage
- System preference is light mode

**Steps:**
1. Clear localStorage
2. Set system to light mode
3. Load app fresh

**Expected Results:**
- App automatically uses light theme
- Toggle shows sun icon

---

### TC-008: Theme Transition Animation

**AC Reference:** AC5  
**Priority:** Medium  
**Type:** Visual

**Preconditions:**
- App loaded in light mode

**Steps:**
1. Click theme toggle
2. Observe transition duration
3. Verify colors transition smoothly

**Expected Results:**
- Transition takes approximately 0.2 seconds
- No jarring color jumps
- Background and text colors both animate

---

### TC-009: Component Dark Mode Coverage

**AC Reference:** AC6  
**Priority:** High  
**Type:** Visual Regression

**Components to Test:**
- [ ] Header
- [ ] Calendar widget
- [ ] Task list
- [ ] Individual task cards
- [ ] Ideas widget  
- [ ] Projects widget
- [ ] Time blocks panel
- [ ] Create task dialog
- [ ] Edit task dialog
- [ ] Notification banner
- [ ] Notification settings
- [ ] Search filter component (new from 1.2)

**Expected Results:**
- Every component renders correctly in dark mode
- No component has styling issues

---

### TC-010: shadcn/ui Component Compatibility

**AC Reference:** AC7  
**Priority:** High  
**Type:** Visual

**Components to Test:**
- [ ] Button variants (default, ghost, outline)
- [ ] Input fields
- [ ] Select dropdowns
- [ ] Checkbox
- [ ] Dialog/Modal
- [ ] Popover
- [ ] Calendar
- [ ] Badge

**Expected Results:**
- All shadcn/ui components automatically support dark mode
- No manual overrides needed

---

### TC-011: Theme Context Accessibility

**AC Reference:** AC8  
**Priority:** Medium  
**Type:** Unit

**Steps:**
1. Create test component deeply nested in tree
2. Access theme context
3. Verify current theme is accessible
4. Verify theme toggle function is accessible

**Expected Results:**
- Any component can read current theme
- Any component can trigger theme change

---

### TC-012: Meta Theme-Color Update

**AC Reference:** AC9  
**Priority:** Medium  
**Type:** Integration

**Preconditions:**
- App loaded on mobile or desktop

**Steps:**
1. Inspect `<meta name="theme-color">` tag
2. Toggle theme
3. Check meta tag value changed

**Expected Results:**
- Light mode: theme-color is light value (e.g., #ffffff)
- Dark mode: theme-color is dark value (e.g., #0a0a0a)

---

### TC-013: Keyboard Accessibility

**AC Reference:** AC10  
**Priority:** High  
**Type:** Accessibility

**Steps:**
1. Tab to theme toggle button
2. Verify visible focus indicator
3. Press Enter/Space to toggle
4. Verify theme changes
5. Check focus is retained

**Expected Results:**
- Toggle receives visible focus ring
- Enter and Space both activate toggle
- Focus remains on button after activation
- Screen reader announces toggle state

---

## Edge Cases

### EC-001: Rapid Toggle Clicks
- Click toggle rapidly 10+ times
- Should not cause visual glitches or state desync

### EC-002: Toggle During Animation
- Toggle while transition is in progress
- Should immediately start new transition

### EC-003: System Preference Changes Live
- While app is open, change system preference
- App should optionally respond (or not, if user has explicit preference)

---

## Test Environment Requirements

| Environment | Priority |
|-------------|----------|
| Chrome (latest) | High |
| Firefox (latest) | High |
| Safari (latest) | High |
| Mobile Safari | Medium |
| Chrome Android | Medium |

---

## Risk-Based Test Priority

1. **Must Test (Blocking):**
   - TC-001: Toggle visible and works
   - TC-004: Persistence works
   - TC-009: All components render correctly

2. **Should Test (Important):**
   - TC-002: Contrast compliance
   - TC-006/007: System preference detection
   - TC-013: Keyboard accessibility

3. **Could Test (Nice to have):**
   - TC-008: Transition smoothness
   - TC-012: Meta theme-color

---

**Test design:** `docs/qa/assessments/1.3-test-design-20251202.md`

